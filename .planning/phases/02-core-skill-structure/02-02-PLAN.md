---
phase: 02-core-skill-structure
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - skills/stacks-dev/SKILL.md
autonomous: true

must_haves:
  truths:
    - "SKILL.md contains 5-phase workflow orchestration"
    - "Each phase has explicit verification steps"
    - "Phase transitions have gates (user confirmation or verification pass)"
    - "Progress indicators show current phase"
    - "Reference files are linked from appropriate phases"
  artifacts:
    - path: "skills/stacks-dev/SKILL.md"
      provides: "Complete workflow orchestration with phases, gates, verification"
      min_lines: 200
      max_lines: 500
  key_links:
    - from: "skills/stacks-dev/SKILL.md"
      to: "references/clarity-design.md"
      via: "markdown link in Design phase"
      pattern: "references/clarity-design\\.md"
    - from: "skills/stacks-dev/SKILL.md"
      to: "references/clarity-tdd.md"
      via: "markdown link in Test phase"
      pattern: "references/clarity-tdd\\.md"
    - from: "skills/stacks-dev/SKILL.md"
      to: "references/clarity-cli.md"
      via: "markdown link in multiple phases"
      pattern: "references/clarity-cli\\.md"
    - from: "skills/stacks-dev/SKILL.md"
      to: "references/clarity-frontend.md"
      via: "markdown link in Frontend phase"
      pattern: "references/clarity-frontend\\.md"
---

<objective>
Write the complete SKILL.md workflow orchestration with 5 phases, explicit gates, progress indicators, and verification steps.

Purpose: Transform the placeholder SKILL.md into a comprehensive workflow guide that orchestrates Clarity development through design -> tests -> implementation -> verification -> frontend phases. This is the core of the stacks-dev skill.

Output: Complete SKILL.md under 500 lines with workflow orchestration, phase transitions, and verification behavior.
</objective>

<execution_context>
@/Users/kenny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kenny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-skill-structure/02-CONTEXT.md
@.planning/phases/02-core-skill-structure/02-RESEARCH.md
@.planning/phases/02-core-skill-structure/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write SKILL.md workflow orchestration</name>
  <files>skills/stacks-dev/SKILL.md</files>
  <action>
Replace the placeholder SKILL.md with complete workflow orchestration. Structure:

**1. YAML Frontmatter (keep existing):**
- name, description, license, metadata, allowed-tools (unchanged from Phase 1)

**2. Introduction Section (~20 lines):**
- Brief skill description
- Core capabilities bullet list
- When skill activates (triggers)

**3. Workflow Overview (~15 lines):**
- 5 phases: Design -> Tests -> Implementation -> Verification -> Frontend
- Progress indicator format: "Phase X/5: [Phase Name]"
- Note about phase transitions requiring verification or user confirmation

**4. Phase 1: Design (~50 lines):**
- Purpose: Define contract requirements, data structures, public interface
- Steps:
  1. Gather requirements from user
  2. Define data structures (vars, maps, constants)
  3. Specify public functions with inputs/outputs
  4. Consider upgradability patterns
- Reference link: [references/clarity-design.md](references/clarity-design.md)
- Verification checklist:
  - [ ] Requirements documented
  - [ ] Data structures defined
  - [ ] Public function signatures specified
  - [ ] Upgradability considered
- Gate: User confirmation to proceed

**5. Phase 2: Tests (~60 lines):**
- Purpose: Write comprehensive unit tests before implementation
- Steps:
  1. Create test file using `clarinet contract new`
  2. Write tests for each public function
  3. Test success cases, error cases, edge cases
  4. Run `clarinet test` to verify tests fail (no implementation yet)
- Reference link: [references/clarity-tdd.md](references/clarity-tdd.md)
- Verification checklist:
  - [ ] Test file exists for each contract
  - [ ] All public functions have tests
  - [ ] `clarinet test` runs without syntax errors
  - [ ] Tests fail as expected (RED phase)
- Gate: Automated verification (tests fail appropriately)

**6. Phase 3: Implementation (~60 lines):**
- Purpose: Write Clarity code to pass tests
- Steps:
  1. Implement data structures from design
  2. Implement public functions one at a time
  3. Run tests after each function
  4. Apply best practices (meaningful errors, no unnecessary begin, etc.)
- Reference link: [references/clarity-cli.md](references/clarity-cli.md) for commands
- Verification checklist:
  - [ ] All tests pass
  - [ ] `clarinet check` passes (no errors)
  - [ ] Best practices applied
- Gate: Automated verification (all tests pass)

**7. Phase 4: Verification (~50 lines):**
- Purpose: Ensure quality through coverage and security review
- Steps:
  1. Run `clarinet test --coverage`
  2. Verify coverage >= 90%
  3. Review for security issues
  4. Fix any issues and re-run
- Reference link: [references/clarity-cli.md](references/clarity-cli.md)
- Verification checklist:
  - [ ] Coverage >= 90%
  - [ ] No security issues identified
  - [ ] All edge cases covered
- Gate: Automated verification (coverage threshold) + user confirmation for security
- Auto-fix loop: If coverage < 90%, identify uncovered functions, write tests, retry (max 3 attempts)

**8. Phase 5: Frontend (~50 lines):**
- Purpose: Integrate contract with web application
- Steps:
  1. Deploy to devnet using `clarinet devnet start`
  2. Connect wallet with @stacks/connect
  3. Call contract functions with @stacks/transactions
  4. Handle results and errors
- Reference link: [references/clarity-frontend.md](references/clarity-frontend.md)
- Verification checklist:
  - [ ] Contract deployed to devnet
  - [ ] Wallet connects successfully
  - [ ] Contract calls work from frontend
- Gate: User verification (manual testing)

**9. Navigation Section (~20 lines):**
- How to jump between phases
- Warning about skipping phases
- Backward navigation confirmation

**10. Verification Behavior Section (~30 lines):**
- Automatic verification after each phase
- Summary first ("All checks passed" or "X issues found")
- Auto-fix attempts (max 3) before escalating
- How issues are reported

**Format guidelines:**
- Use clear headers (## for phases)
- Keep code examples minimal (link to references)
- Include progress indicator template at each phase
- Total file must be under 500 lines (target: 350-400)
  </action>
  <verify>
1. Line count check:
   ```bash
   wc -l skills/stacks-dev/SKILL.md
   ```
   Should be 200-500 lines

2. Phase count check:
   Verify file contains 5 numbered phases

3. Reference links check:
   ```bash
   grep -c "references/" skills/stacks-dev/SKILL.md
   ```
   Should be >= 4 (one per phase minimum)

4. Verification checklist check:
   ```bash
   grep -c "Verification" skills/stacks-dev/SKILL.md
   ```
   Should be >= 5 (one per phase)

5. YAML frontmatter preserved:
   ```bash
   head -15 skills/stacks-dev/SKILL.md
   ```
   Should show name, description, license, metadata, allowed-tools
  </verify>
  <done>SKILL.md contains complete 5-phase workflow with gates, verification steps, progress indicators, and reference links</done>
</task>

</tasks>

<verification>
After completing the task:

1. **Line count validation:**
   ```bash
   wc -l skills/stacks-dev/SKILL.md
   ```
   Must be between 200-500 lines

2. **Structure validation:**
   ```bash
   grep "^## Phase" skills/stacks-dev/SKILL.md
   ```
   Should show 5 phases

3. **Reference integration:**
   ```bash
   grep -E "references/clarity-(design|tdd|cli|frontend)\\.md" skills/stacks-dev/SKILL.md
   ```
   Should find all 4 reference files linked

4. **Verification sections:**
   Each phase should have a "### Verification" subsection

5. **Gate patterns:**
   Grep for "proceed" or "Continue" to verify transition language exists

6. **skills-ref validation:**
   ```bash
   npx @anthropic/skills-ref validate ./skills/stacks-dev
   ```
   Should pass all checks
</verification>

<success_criteria>
1. SKILL.md is between 200-500 lines (under limit with headroom)
2. Contains 5 workflow phases: Design, Tests, Implementation, Verification, Frontend
3. Each phase has verification checklist
4. Each phase links to appropriate reference file
5. Progress indicators present (Phase X/5 format)
6. Gate behavior defined for each transition
7. Auto-fix loop documented in Verification phase
8. skills-ref validate passes
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-skill-structure/02-02-SUMMARY.md`
</output>
