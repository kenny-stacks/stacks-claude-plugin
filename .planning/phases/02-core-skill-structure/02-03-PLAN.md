---
phase: 02-core-skill-structure
plan: 03
type: execute
wave: 3
depends_on: ["02-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Skill passes skills-ref validation"
    - "Skill auto-invokes when user mentions Stacks or Clarity"
    - "SKILL.md stays under 500 lines"
    - "All 4 reference files are accessible from SKILL.md"
  artifacts:
    - path: "skills/stacks-dev/SKILL.md"
      provides: "Validated skill file"
      contains: "name: stacks-dev"
  key_links:
    - from: "skills/stacks-dev/SKILL.md"
      to: "skills/stacks-dev/references/"
      via: "markdown links"
      pattern: "references/clarity"
---

<objective>
Validate the complete stacks-dev skill structure and test auto-invocation triggers.

Purpose: Ensure the skill meets all Phase 2 requirements (SKIL-01 through SKIL-05, QUAL-01 through QUAL-03) before marking phase complete. This includes formal validation with skills-ref and manual testing of auto-invocation.

Output: Validation results confirming skill is ready for use.
</objective>

<execution_context>
@/Users/kenny/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kenny/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-skill-structure/02-CONTEXT.md
@.planning/phases/02-core-skill-structure/02-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run skills-ref validation</name>
  <files></files>
  <action>
Run formal validation using skills-ref tool:

```bash
npx @anthropic/skills-ref validate ./skills/stacks-dev
```

Check for:
1. Valid YAML frontmatter (name, description, license, metadata, allowed-tools)
2. Name matches directory name
3. Description within length limit (1-1024 chars)
4. Body under 5000 tokens (~500 lines)

If validation fails:
- Identify specific failures from output
- Fix issues in SKILL.md
- Re-run validation
- Repeat until passing

Document final validation output.
  </action>
  <verify>
```bash
npx @anthropic/skills-ref validate ./skills/stacks-dev
```
Should output "Validation passed" or similar success message
  </verify>
  <done>skills-ref validate passes with no errors</done>
</task>

<task type="auto">
  <name>Task 2: Verify file structure and line counts</name>
  <files></files>
  <action>
Verify Phase 2 requirements are met:

**SKIL-03: Body under 500 lines**
```bash
wc -l skills/stacks-dev/SKILL.md
```
Must be < 500 lines

**SKIL-04: Progressive disclosure (reference files exist)**
```bash
ls -la skills/stacks-dev/references/
```
Should show 4 .md files

**SKIL-05: One level deep (no nested references)**
```bash
grep -l "references/" skills/stacks-dev/references/*.md
```
Should return empty (reference files don't reference other files)

**Reference file line counts**
```bash
wc -l skills/stacks-dev/references/*.md
```
Each should be 50-200 lines

Document all verification results.
  </action>
  <verify>
All checks pass:
- SKILL.md < 500 lines
- 4 reference files exist
- No nested references
- Reference files are 50-200 lines each
  </verify>
  <done>File structure and line counts meet all requirements</done>
</task>

<task type="auto">
  <name>Task 3: Verify SKILL.md content requirements</name>
  <files></files>
  <action>
Verify QUAL requirements in SKILL.md:

**QUAL-01: Verification steps exist**
```bash
grep -c "### Verification" skills/stacks-dev/SKILL.md
```
Should be >= 5 (one per phase)

**QUAL-02: Tools declared (already verified in Phase 1)**
```bash
grep "allowed-tools" skills/stacks-dev/SKILL.md
```
Should exist

**QUAL-03: Clear phase transitions**
```bash
grep -E "Phase [0-9]/5" skills/stacks-dev/SKILL.md
```
Should show progress indicator pattern

Check for:
- Design -> Tests -> Implementation -> Verification -> Frontend phases
- Each phase has verification checklist
- Each phase links to reference file
- Gate behavior documented

Document verification results.
  </action>
  <verify>
All content requirements met:
- 5 verification sections (one per phase)
- allowed-tools declared
- Phase X/5 progress indicators
- All phases link to references
  </verify>
  <done>SKILL.md meets all QUAL requirements (verification steps, tools, transitions)</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete stacks-dev skill with:
- 5-phase workflow orchestration in SKILL.md
- 4 reference files for progressive disclosure
- Verification steps and gates at each phase
- Auto-invocation triggers for Stacks/Clarity keywords
  </what-built>
  <how-to-verify>
1. **Start Claude Code with plugin loaded:**
   ```bash
   cd /path/to/your/test/project
   claude --plugin-dir /path/to/stacks-skills
   ```

2. **Test auto-invocation:**
   Say: "I want to build a Clarity smart contract"

   Expected: Skill should auto-load and show Phase 1 (Design) guidance

3. **Test reference loading:**
   In the skill context, ask: "Show me the design patterns"

   Expected: Claude should reference or load clarity-design.md

4. **Verify skill appears in help:**
   Type: `/help`

   Expected: stacks-dev skill should appear in available skills list

5. **Check workflow presence:**
   Ask: "What are the development phases?"

   Expected: Claude should describe 5 phases with verification steps
  </how-to-verify>
  <resume-signal>Type "approved" if skill works as expected, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
All tasks complete when:

1. **Automated checks pass:**
   - skills-ref validate: PASS
   - Line count < 500: PASS
   - Reference files exist: PASS
   - No nested references: PASS
   - Verification sections present: PASS

2. **Manual verification complete:**
   - Skill auto-invokes on Stacks/Clarity mention
   - Reference files accessible
   - Workflow phases visible
   - User approves checkpoint
</verification>

<success_criteria>
1. skills-ref validate passes with no errors
2. SKILL.md is under 500 lines
3. All 4 reference files exist and are 50-200 lines each
4. No nested references in reference files
5. SKILL.md has verification sections for all 5 phases
6. Skill auto-invokes when user mentions Stacks or Clarity (human verified)
7. User approves the complete skill behavior
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-skill-structure/02-03-SUMMARY.md`
</output>
